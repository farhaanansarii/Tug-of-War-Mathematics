  <!DOCTYPE html>
  <html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Tug of War ‚Äì Mathematics</title>
  <style>
  /* =============================================
     RESET & ROOT VARIABLES
  ============================================= */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --blue:       #1A4FC4;
    --blue-l:     #5B9BD5;
    --blue-d:     #0B2D8C;
    --red:        #C41A1A;
    --red-l:      #E05252;
    --red-d:      #8C0B0B;
    --gold:       #FFD600;
    --bg:         #0D1B2A;
    --panel-blue: rgba(10,35,100,0.6);
    --panel-red:  rgba(100,10,10,0.6);
    --text:       #F0F4FF;
    --subtext:    rgba(240,244,255,0.5);
    --radius:     12px;

    /* Fluid spacing */
    --sp-xs: clamp(3px, 0.5vw, 6px);
    --sp-sm: clamp(6px, 1vw, 12px);
    --sp-md: clamp(10px, 1.5vw, 18px);
    --sp-lg: clamp(14px, 2vw, 24px);
  }

  html, body {
    width: 100%; height: 100%;
    overflow: hidden;
    font-family: 'Georgia', 'Times New Roman', serif;
    background: var(--bg);
    color: var(--text);
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* =============================================
     SCREENS
  ============================================= */
  .screen { display: none; width: 100vw; height: 100vh; }
  .screen.active { display: flex; }

  /* =============================================
     START SCREEN
  ============================================= */
  #start-screen {
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: clamp(12px, 2.5vh, 30px);
    background:
      radial-gradient(ellipse at 25% 40%, rgba(26,79,196,0.25) 0%, transparent 55%),
      radial-gradient(ellipse at 75% 60%, rgba(196,26,26,0.25) 0%, transparent 55%),
      linear-gradient(160deg, #060d1a 0%, #0d1b2a 50%, #06100d 100%);
    padding: var(--sp-lg);
  }

  .game-title {
    font-size: clamp(1.6rem, 6vw, 4.2rem);
    font-weight: 900;
    text-align: center;
    line-height: 1.1;
    letter-spacing: 1px;
    text-shadow: 0 2px 24px rgba(255,214,0,0.3);
  }
  .game-title .accent { color: var(--gold); }
  .game-subtitle {
    font-size: clamp(0.65rem, 1.8vw, 1rem);
    color: var(--subtext);
    text-transform: uppercase;
    letter-spacing: 4px;
    text-align: center;
  }
  .diff-section { display: flex; flex-direction: column; align-items: center; gap: 10px; }
  .diff-label { font-size: clamp(0.65rem, 1.5vw, 0.8rem); color: var(--subtext); text-transform: uppercase; letter-spacing: 3px; }
  .diff-row { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
  .diff-btn {
    padding: clamp(8px,1.5vh,12px) clamp(16px,3vw,28px);
    border: 2px solid rgba(255,255,255,0.18);
    background: transparent;
    color: var(--text);
    font-size: clamp(0.75rem, 2vw, 0.95rem);
    font-family: inherit;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.25s;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .diff-btn:hover { border-color: var(--gold); color: var(--gold); }
  .diff-btn.active { background: var(--gold); color: #000; border-color: var(--gold); font-weight: 700; }
  .start-btn {
    padding: clamp(12px,2.5vh,18px) clamp(36px,7vw,64px);
    background: linear-gradient(135deg, var(--gold) 0%, #FF9800 100%);
    color: #000;
    font-size: clamp(0.95rem, 2.5vw, 1.3rem);
    font-weight: 700;
    font-family: inherit;
    border: none;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s;
    text-transform: uppercase;
    letter-spacing: 2px;
    box-shadow: 0 6px 32px rgba(255,214,0,0.35);
  }
  .start-btn:hover { transform: translateY(-3px); box-shadow: 0 12px 42px rgba(255,214,0,0.5); }
  .start-btn:active { transform: translateY(0); }

  /* =============================================
     GAME SCREEN ‚Äì FLEX LAYOUT ENGINE
     Adapts layout direction based on screen shape
  ============================================= */
  #game-screen {
    flex-direction: column;
    height: 100vh;
    overflow: hidden;
  }

  /* TOP BAR */
  .top-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--sp-xs) var(--sp-md);
    background: rgba(0,0,0,0.5);
    border-bottom: 1px solid rgba(255,255,255,0.07);
    flex-shrink: 0;
    z-index: 20;
    gap: var(--sp-sm);
    min-height: clamp(44px, 7vh, 64px);
  }
  .score-pill {
    display: flex;
    align-items: center;
    padding: clamp(4px,1vh,8px) clamp(10px,2vw,22px);
    border-radius: 50px;
    font-weight: 700;
    gap: 6px;
  }
  .score-pill.blue { background: linear-gradient(135deg, var(--blue-d), var(--blue)); }
  .score-pill.red  { background: linear-gradient(135deg, var(--red), var(--red-d)); }
  .score-pill-label {
    font-size: clamp(0.45rem, 1.2vw, 0.68rem);
    color: rgba(255,255,255,0.7);
    text-transform: uppercase;
    letter-spacing: 1px;
    white-space: nowrap;
  }
  .score-pill-num { font-size: clamp(1rem, 3vw, 1.8rem); line-height: 1; }
  .top-center { display: flex; flex-direction: column; align-items: center; gap: 1px; }
  .top-timer-label { font-size: clamp(0.4rem, 1.1vw, 0.6rem); color: var(--subtext); text-transform: uppercase; letter-spacing: 2px; }
  .top-timer {
    font-size: clamp(1.4rem, 4vw, 2.4rem);
    font-weight: 900;
    color: var(--gold);
    line-height: 1;
    min-width: 40px;
    text-align: center;
  }
  .top-timer.urgent { color: var(--red-l); animation: urgBlink 0.5s infinite; }
  @keyframes urgBlink { 0%,100%{opacity:1} 50%{opacity:0.15} }

  /* PROGRESS STRIP */
  .progress-strip {
    display: flex;
    gap: 5px;
    padding: 4px var(--sp-md);
    background: rgba(0,0,0,0.3);
    border-bottom: 1px solid rgba(255,255,255,0.04);
    flex-shrink: 0;
  }
  .prog-track { flex:1; height: 5px; background: rgba(255,255,255,0.07); border-radius: 10px; overflow: hidden; }
  .prog-fill { height: 100%; border-radius: 10px; width: 0%; transition: width 0.4s ease; }
  .prog-track.blue .prog-fill { background: linear-gradient(90deg, var(--blue-d), var(--blue-l)); }
  .prog-track.red  .prog-fill { background: linear-gradient(90deg, var(--red-l), var(--red-d)); }

  /* =============================================
     GAME MAIN ‚Äî flex row (desktop/landscape)
  ============================================= */
  .game-main {
    display: flex;
    flex: 1;
    overflow: hidden;
    min-height: 0;
  }

  /* ‚îÄ‚îÄ TEAM PANELS ‚îÄ‚îÄ */
  .team-panel {
    display: flex;
    flex-direction: column;
    gap: var(--sp-sm);
    padding: var(--sp-sm);
    flex-shrink: 0;
    position: relative;
    overflow: hidden;
    width: clamp(160px, 22vw, 310px);
  }
  .team-panel.blue {
    background: var(--panel-blue);
    border-right: 1px solid rgba(91,155,213,0.18);
    backdrop-filter: blur(12px);
  }
  .team-panel.red {
    background: var(--panel-red);
    border-left: 1px solid rgba(224,82,82,0.18);
    backdrop-filter: blur(12px);
  }
  .panel-header { display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }
  .team-name {
    font-size: clamp(0.65rem, 1.5vw, 0.92rem);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2px;
  }
  .q-badge {
    font-size: clamp(0.55rem, 1vw, 0.7rem);
    color: var(--subtext);
    background: rgba(255,255,255,0.08);
    padding: 2px 8px;
    border-radius: 20px;
  }

  /* QUESTION BOX */
  .question-box {
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: var(--radius);
    padding: var(--sp-sm) var(--sp-xs);
    text-align: center;
    flex-shrink: 0;
  }
  .question-text {
    font-size: clamp(1.2rem, 3.5vw, 2.8rem);
    font-weight: 900;
    letter-spacing: 3px;
    line-height: 1;
  }
  .answer-display {
    margin-top: 6px;
    background: rgba(255,255,255,0.08);
    border: 2px solid rgba(255,255,255,0.16);
    border-radius: 8px;
    padding: clamp(4px,0.8vh,8px);
    font-size: clamp(0.95rem, 2.5vw, 1.6rem);
    color: var(--text);
    text-align: center;
    font-weight: 700;
    min-height: clamp(30px, 5vh, 48px);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: border-color 0.3s;
    letter-spacing: 2px;
  }
  .answer-display.shake { animation: shake 0.4s ease; border-color: var(--red-l) !important; }
  @keyframes shake {
    0%,100%{transform:translateX(0)}
    20%{transform:translateX(-6px)} 40%{transform:translateX(6px)}
    60%{transform:translateX(-4px)} 80%{transform:translateX(4px)}
  }
  .answer-display.flash-ok { border-color: #4CAF50 !important; background: rgba(76,175,80,0.1); }
  .answer-display.empty { color: var(--subtext); }
  .answer-display.has-val { color: var(--text); }

  /* KEYPAD */
  .keypad {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: clamp(3px, 0.5vw, 7px);
    flex: 1;
    min-height: 0;
  }
  .key {
    border: none;
    border-radius: clamp(5px, 0.8vw, 9px);
    font-weight: 700;
    font-family: inherit;
    cursor: pointer;
    transition: transform 0.1s, filter 0.15s;
    touch-action: manipulation;
    -webkit-user-select: none;
    user-select: none;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: clamp(0.78rem, 1.8vw, 1.2rem);
    min-height: 0;
  }
  .key:active { transform: scale(0.88); filter: brightness(1.3); }
  .team-panel.blue .key.digit { background: rgba(91,155,213,0.15); color:#fff; border:1px solid rgba(91,155,213,0.25); }
  .team-panel.blue .key.digit:hover { background: rgba(91,155,213,0.35); }
  .team-panel.red  .key.digit { background: rgba(224,82,82,0.15); color:#fff; border:1px solid rgba(224,82,82,0.25); }
  .team-panel.red  .key.digit:hover { background: rgba(224,82,82,0.35); }
  .key.clear { background:rgba(255,152,0,0.18); color:#FFB300; border:1px solid rgba(255,152,0,0.3); font-size: clamp(0.6rem,1.4vw,0.85rem); }
  .key.clear:hover { background:rgba(255,152,0,0.4); }
  .key.submit { background:linear-gradient(135deg,#1B5E20,#388E3C); color:#fff; border:1px solid #4CAF50; font-size: clamp(0.6rem,1.4vw,0.85rem); }
  .key.submit:hover { filter: brightness(1.15); }

  /* DONE OVERLAY */
  .team-panel.done { opacity:0.55; pointer-events:none; }
  .team-panel.done::after {
    content:'‚úì Done!';
    position:absolute; inset:0;
    display:flex; align-items:center; justify-content:center;
    font-size: clamp(1rem, 2.8vw, 1.8rem);
    color:var(--gold);
    background:rgba(0,0,0,0.65);
    border-radius:8px;
    font-weight:700;
    letter-spacing: 1px;
  }

  /* =============================================
     CENTER ARENA
  ============================================= */
  .arena {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
    min-width: 0;
    min-height: 0;
  }
  .ground {
    position:absolute; bottom:0; left:0; right:0;
    height:30%;
    background:linear-gradient(180deg, rgba(34,80,20,0.28) 0%, rgba(10,30,5,0.72) 100%);
    border-top:2px solid rgba(60,140,30,0.22);
  }
  .ground::before {
    content:''; position:absolute; top:-4px; left:0; right:0; height:8px;
    background:repeating-linear-gradient(90deg, rgba(55,130,25,0.7) 0px, rgba(55,130,25,0.7) 3px, transparent 3px, transparent 9px);
  }
  .arena::before {
    content:''; position:absolute; inset:0; pointer-events:none;
    background:radial-gradient(ellipse at 50% 28%, rgba(30,60,120,0.2) 0%, transparent 68%);
  }
  .cloud { position:absolute; background:rgba(255,255,255,0.04); border-radius:50px; animation:drift linear infinite; }
  @keyframes drift { from{transform:translateX(-160px)} to{transform:translateX(calc(100vw+160px))} }

  .arena-score-row {
    position:relative; z-index:10;
    display:flex; gap:clamp(8px,2vw,22px);
    margin-bottom: clamp(4px, 1vh, 12px);
  }
  .arena-pill {
    padding: clamp(3px,0.7vh,7px) clamp(12px,2.5vw,26px);
    border-radius:50px;
    font-size: clamp(0.85rem, 2.5vw, 1.5rem);
    font-weight:900;
    color:#fff;
  }
  .arena-pill.blue { background:var(--blue); box-shadow:0 4px 18px rgba(26,79,196,0.45); }
  .arena-pill.red  { background:var(--red);  box-shadow:0 4px 18px rgba(196,26,26,0.45); }

  /* ROPE STAGE */
  .rope-stage {
    position:relative;
    width:100%;
    height: clamp(90px, 22vh, 220px);
    display:flex;
    align-items:flex-end;
    flex-shrink: 0;
  }
  .win-zone {
    position:absolute; bottom:0; top:0; width:11%;
    display:flex; align-items:center; justify-content:center;
    font-size: clamp(0.38rem, 0.8vw, 0.58rem);
    text-transform:uppercase; letter-spacing:1px;
    color:rgba(255,255,255,0.25);
    pointer-events:none;
    writing-mode:vertical-lr;
  }
  .win-zone.left  { left:0; background:linear-gradient(90deg,rgba(26,79,196,0.14),transparent); transform:rotate(180deg); }
  .win-zone.right { right:0; background:linear-gradient(-90deg,rgba(196,26,26,0.14),transparent); }
  .center-flag {
    position:absolute; left:50%; bottom:0; top:50%;
    width:2px; transform:translateX(-50%);
    z-index:8;
    display:flex; flex-direction:column; align-items:center;
  }
  .flag-pole {
    width:2px; flex:1;
    background:repeating-linear-gradient(180deg,
      rgba(255,255,255,0.6) 0px, rgba(255,255,255,0.6) 5px,
      transparent 5px, transparent 11px);
  }
  .flag-icon { font-size: clamp(0.8rem, 2vw, 1.4rem); filter:drop-shadow(0 0 6px var(--gold)); margin-bottom:2px; }
  .movers {
    position:absolute; inset:0;
    transition:transform 0.55s cubic-bezier(0.34,1.35,0.64,1);
    will-change:transform;
  }
  .rope {
    position:absolute; left:0; right:0;
    top:90%; transform:translateY(-50%);
    height: clamp(7px, 1.4vh, 14px);
    background:repeating-linear-gradient(90deg,
      #8B5E3C 0px,#6B4226 7px,
      #9C6B44 7px,#7B4F2E 14px,
      #5D3A1A 14px,#8B5E3C 21px);
    border-radius:7px;
    box-shadow:0 3px 10px rgba(0,0,0,0.6), inset 0 2px 3px rgba(255,200,140,0.1);
  }
  .rope::after {
    content:''; position:absolute; inset:0; border-radius:7px;
    background:repeating-linear-gradient(-45deg,
      transparent 0px,transparent 3px,rgba(0,0,0,0.1) 3px,rgba(0,0,0,0.1) 4px);
  }
  .team-group { position:absolute; bottom:0; display:flex; align-items:flex-end; }
  .team-group.left  { left:3%; gap: clamp(-8px,-1vw,0px); }
  .team-group.right { right:3%; flex-direction:row-reverse; gap: clamp(-8px,-1vw,0px); }
  .player-fig {
    width:  clamp(24px, 4.5vw, 68px);
    height: clamp(54px, 11vh, 140px);
    flex-shrink:0;
    filter:drop-shadow(0 4px 7px rgba(0,0,0,0.55));
  }
  @keyframes pullLeft  { 0%,100%{transform:rotate(-4deg) translateY(0)} 45%{transform:rotate(2.5deg) translateY(-4px)} }
  @keyframes pullRight { 0%,100%{transform:rotate(4deg)  translateY(0)} 45%{transform:rotate(-2.5deg) translateY(-4px)} }
  .team-group.left  .player-fig { animation:pullLeft  0.72s ease-in-out infinite; }
  .team-group.right .player-fig { animation:pullRight 0.72s ease-in-out infinite; }
  .player-fig:nth-child(2) { animation-delay:0.13s !important; }
  .player-fig:nth-child(3) { animation-delay:0.26s !important; }

  /* =============================================
     FLASH OVERLAYS
  ============================================= */
  .flash-overlay { position:fixed; inset:0; pointer-events:none; z-index:100; opacity:0; }
  .flash-overlay.t1 { background:radial-gradient(ellipse at 8% 50%,rgba(26,79,196,0.45),transparent 65%); }
  .flash-overlay.t2 { background:radial-gradient(ellipse at 92% 50%,rgba(196,26,26,0.45),transparent 65%); }
  .flash-overlay.show { animation:doFlash 0.65s ease forwards; }
  @keyframes doFlash { 0%{opacity:1} 100%{opacity:0} }

  /* =============================================
     WINNER SCREEN
  ============================================= */
  #winner-screen {
    flex-direction:column; align-items:center; justify-content:center;
    gap: clamp(12px, 2.5vh, 28px);
    padding: var(--sp-lg);
    background:
      radial-gradient(ellipse at 30% 40%,rgba(26,79,196,0.2),transparent 55%),
      radial-gradient(ellipse at 70% 60%,rgba(196,26,26,0.2),transparent 55%),
      linear-gradient(160deg,#060d1a,#0d1b2a);
  }
  .winner-crown { font-size: clamp(2rem, 6vw, 4rem); animation:bounce 0.8s infinite alternate; }
  @keyframes bounce { from{transform:translateY(0)} to{transform:translateY(-10px)} }
  .winner-title { font-size: clamp(1.8rem, 7vw, 4.5rem); font-weight:900; color:var(--gold); text-shadow:0 0 40px var(--gold); letter-spacing:3px; text-align:center; }
  .winner-team-name {
    font-size: clamp(1rem, 3.5vw, 2.3rem); font-weight:700; color:#fff; text-align:center;
    padding: clamp(9px,2vh,18px) clamp(22px,5vw,50px); border-radius:14px;
  }
  .winner-team-name.blue { background:linear-gradient(135deg,var(--blue-d),var(--blue)); box-shadow:0 0 50px rgba(26,79,196,0.5); }
  .winner-team-name.red  { background:linear-gradient(135deg,var(--red),var(--red-d));   box-shadow:0 0 50px rgba(196,26,26,0.5); }
  .winner-team-name.draw { background:linear-gradient(135deg,#444,#777); }
  .final-score-row { display:flex; gap: clamp(12px, 3vw, 30px); align-items:center; flex-wrap: wrap; justify-content: center; }
  .final-box { display:flex; flex-direction:column; align-items:center; gap:4px; padding: clamp(8px,2vh,18px) clamp(16px,4vw,36px); border-radius:13px; }
  .final-box.blue { background:rgba(26,79,196,0.22); border:2px solid var(--blue); }
  .final-box.red  { background:rgba(196,26,26,0.22); border:2px solid var(--red); }
  .final-num { font-size: clamp(1.6rem, 5vw, 3rem); font-weight:900; }
  .final-lbl { font-size: clamp(0.55rem, 1.3vw, 0.78rem); color:var(--subtext); text-transform:uppercase; letter-spacing:2px; }
  .vs-sep { font-size: clamp(0.85rem, 2vw, 1.4rem); color:var(--subtext); font-weight:700; }
  .play-again-btn {
    padding: clamp(10px,2vh,16px) clamp(28px,6vw,56px);
    background:linear-gradient(135deg,var(--gold),#FF9800);
    color:#000; font-size: clamp(0.85rem, 2vw, 1.15rem);
    font-weight:700; font-family:inherit; border:none; border-radius:50px;
    cursor:pointer; transition:all 0.3s; text-transform:uppercase;
    letter-spacing:2px; box-shadow:0 6px 26px rgba(255,214,0,0.3);
  }
  .play-again-btn:hover { transform:translateY(-3px); box-shadow:0 12px 38px rgba(255,214,0,0.5); }

  /* CONFETTI */
  #confetti { position:fixed; inset:0; pointer-events:none; z-index:300; overflow:hidden; }
  .conf { position:absolute; top:-22px; animation:confFall linear forwards; border-radius:2px; }
  @keyframes confFall { 0%{transform:translateY(0) rotate(0deg);opacity:1} 100%{transform:translateY(112vh) rotate(550deg);opacity:0} }

  /* =============================================
     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  RESPONSIVE BREAKPOINTS  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà
  ============================================= */

  /* ‚îÄ‚îÄ DESKTOP / WIDE LANDSCAPE (>= 900px) ‚îÄ‚îÄ */
  @media (min-width: 900px) {
    .team-panel { width: clamp(200px, 23vw, 320px); }
    .question-text { font-size: clamp(1.8rem, 3.5vw, 3rem); }
  }

  /* ‚îÄ‚îÄ TABLET LANDSCAPE (600px‚Äì899px landscape) ‚îÄ‚îÄ */
  @media (max-width: 899px) and (orientation: landscape) {
    .team-panel { width: clamp(155px, 20vw, 240px); }
    .question-text { font-size: clamp(1.1rem, 2.8vw, 2rem); }
    .rope-stage { height: clamp(80px, 18vh, 150px); }
    .player-fig {
      width:  clamp(20px, 4vw, 50px);
      height: clamp(44px, 9vh, 100px);
    }
    .top-bar { min-height: 40px; }
  }

  /* ‚îÄ‚îÄ SMALL PHONE LANDSCAPE (<= 600px landscape) ‚îÄ‚îÄ */
  @media (max-width: 600px) and (orientation: landscape) {
    .team-panel { width: clamp(130px, 19vw, 185px); gap: 3px; padding: 5px; }
    .question-text { font-size: clamp(0.95rem, 3vw, 1.5rem); letter-spacing: 1px; }
    .answer-display { font-size: clamp(0.85rem, 2.5vw, 1.2rem); min-height: 24px; padding: 3px 6px; }
    .rope-stage { height: clamp(65px, 16vh, 110px); }
    .player-fig { width: clamp(16px, 3.5vw, 38px); height: clamp(36px, 8vh, 72px); }
    .top-bar { min-height: 34px; padding: 2px 8px; }
    .progress-strip { padding: 3px 8px; }
    .progress-strip .prog-track { height: 4px; }
    .keypad { gap: 3px; }
    .key { font-size: clamp(0.65rem, 2vw, 0.9rem); border-radius: 5px; }
    .arena-score-row { margin-bottom: 3px; gap: 8px; }
    .arena-pill { font-size: clamp(0.75rem, 2.5vw, 1.1rem); padding: 3px 10px; }
    .flag-icon { font-size: 0.75rem; }
  }

  /* ‚îÄ‚îÄ PORTRAIT PHONES & TABLETS (<= 767px portrait) ‚îÄ‚îÄ
     Full layout flip: stacked panels top+bottom,
     arena in the middle. Two-column keypad stretches
     each side for thumb-friendly tapping.
  ============================================= */
  @media (max-width: 767px) and (orientation: portrait) {
    .game-main { flex-direction: column; }

    /* Panels become horizontal strips */
    .team-panel {
      width: 100%;
      flex-direction: row;
      align-items: stretch;
      flex-wrap: nowrap;
      gap: var(--sp-xs);
      padding: var(--sp-xs) var(--sp-sm);
      flex-shrink: 0;
      min-height: 0;
    }
    .team-panel.blue {
      border-right: none;
      border-bottom: 1px solid rgba(91,155,213,0.15);
      order: -1;
    }
    .team-panel.red {
      border-left: none;
      border-top: 1px solid rgba(224,82,82,0.15);
    }

    /* Inner layout for portrait panel */
    .panel-inner {
      display: flex;
      flex-direction: column;
      gap: var(--sp-xs);
      flex-shrink: 0;
      width: clamp(90px, 28vw, 160px);
    }
    .panel-header { width: 100%; }
    .question-box {
      padding: var(--sp-xs);
      flex-shrink: 0;
    }
    .question-text { font-size: clamp(1.2rem, 5vw, 2rem); letter-spacing: 2px; }
    .answer-display {
      font-size: clamp(1rem, 4vw, 1.5rem);
      min-height: clamp(28px, 5vh, 40px);
    }

    /* Keypad expands to fill remaining width */
    .keypad {
      flex: 1;
      grid-template-columns: repeat(3, 1fr);
      gap: clamp(3px, 1vw, 7px);
    }
    .key { font-size: clamp(0.9rem, 3.5vw, 1.3rem); border-radius: 7px; }

    /* Arena gets remaining space */
    .arena {
      flex: 1;
      min-height: clamp(100px, 25vw, 200px);
    }
    .rope-stage { height: clamp(80px, 20vw, 170px); }
    .player-fig {
      width:  clamp(22px, 5.5vw, 50px);
      height: clamp(48px, 12vw, 110px);
    }
    .arena-pill { font-size: clamp(0.85rem, 3.5vw, 1.3rem); padding: 4px 14px; }
    .arena-score-row { margin-bottom: clamp(4px, 1.5vw, 10px); }
  }

  /* ‚îÄ‚îÄ VERY SMALL PORTRAIT (<= 375px) ‚îÄ‚îÄ */
  @media (max-width: 375px) and (orientation: portrait) {
    .question-text { font-size: clamp(1rem, 5.5vw, 1.6rem); }
    .key { font-size: clamp(0.82rem, 3.8vw, 1.1rem); }
    .score-pill-num { font-size: clamp(0.9rem, 3.5vw, 1.4rem); }
    .top-timer { font-size: clamp(1.2rem, 4.5vw, 1.8rem); }
    .panel-inner { width: clamp(80px, 26vw, 130px); }
  }

  /* ‚îÄ‚îÄ TALL PORTRAIT TABLETS (>= 768px portrait) ‚îÄ‚îÄ */
  @media (min-width: 768px) and (orientation: portrait) {
    .game-main { flex-direction: column; }
    .team-panel {
      width: 100%;
      flex-direction: row;
      gap: var(--sp-sm);
      padding: var(--sp-sm) var(--sp-md);
      flex-shrink: 0;
    }
    .team-panel.blue { border-right: none; border-bottom: 1px solid rgba(91,155,213,0.15); order: -1; }
    .team-panel.red  { border-left: none;  border-top:  1px solid rgba(224,82,82,0.15); }
    .panel-inner { width: clamp(130px, 24vw, 200px); flex-shrink: 0; display: flex; flex-direction: column; gap: var(--sp-xs); }
    .question-text { font-size: clamp(1.8rem, 5vw, 2.8rem); }
    .answer-display { font-size: clamp(1.3rem, 3.5vw, 2rem); min-height: clamp(36px, 6vh, 52px); }
    .keypad { flex: 1; gap: clamp(5px, 1vw, 10px); }
    .key { font-size: clamp(1rem, 3vw, 1.5rem); border-radius: 10px; }
    .arena { min-height: clamp(140px, 28vw, 260px); }
    .rope-stage { height: clamp(110px, 22vw, 210px); }
    .player-fig { width: clamp(30px, 6vw, 70px); height: clamp(66px, 14vw, 145px); }
  }
  </style>
  </head>
  <body>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê START SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen active" id="start-screen">
    <div class="game-title">‚öîÔ∏è Tug of War<br><span class="accent">Mathematics</span></div>
    <div class="game-subtitle">Team vs Team ¬∑ Math Battle</div>
    <div class="diff-section">
      <div class="diff-label">Difficulty</div>
      <div class="diff-row">
        <button class="diff-btn active" data-diff="easy">Easy</button>
        <button class="diff-btn" data-diff="medium">Medium</button>
        <button class="diff-btn" data-diff="hard">Hard</button>
      </div>
    </div>
    <button class="start-btn" id="startBtn">üéÆ Start Game</button>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GAME SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen" id="game-screen">

    <div class="top-bar">
      <div class="score-pill blue">
        <div class="score-pill-label">Team 1</div>
        <div class="score-pill-num" id="t1Score">0</div>
      </div>
      <div class="top-center">
        <div class="top-timer-label">Time</div>
        <div class="top-timer" id="timerEl">10</div>
      </div>
      <div class="score-pill red">
        <div class="score-pill-label">Team 2</div>
        <div class="score-pill-num" id="t2Score">0</div>
      </div>
    </div>

    <div class="progress-strip">
      <div class="prog-track blue"><div class="prog-fill" id="t1Prog"></div></div>
      <div class="prog-track red"><div class="prog-fill" id="t2Prog"></div></div>
    </div>

    <div class="game-main">

      <!-- TEAM 1 PANEL -->
      <div class="team-panel blue" id="t1Panel">
        <div class="panel-inner">
          <div class="panel-header">
            <div class="team-name" style="color:var(--blue-l)">Team 1</div>
            <div class="q-badge" id="t1Badge">1/10</div>
          </div>
          <div class="question-box">
            <div class="question-text" id="t1Q">?+?=?</div>
            <div class="answer-display empty" id="t1Display">?</div>
          </div>
        </div>
        <div class="keypad" id="t1Pad"></div>
      </div>

      <!-- CENTER ARENA -->
      <div class="arena">
        <div class="ground"></div>
        <div class="cloud" style="width:75px;height:18px;top:8%;animation-duration:28s;animation-delay:-4s"></div>
        <div class="cloud" style="width:50px;height:13px;top:18%;animation-duration:35s;animation-delay:-14s"></div>
        <div class="cloud" style="width:90px;height:22px;top:5%;animation-duration:22s;animation-delay:-8s"></div>

        <div class="arena-score-row">
          <div class="arena-pill blue" id="aT1">0</div>
          <div class="arena-pill red"  id="aT2">0</div>
        </div>

        <div class="rope-stage" id="ropeStage">
          <div class="win-zone left">‚Üê Team 1 Wins</div>
          <div class="win-zone right">Team 2 Wins ‚Üí</div>
          <div class="center-flag">
            <div class="flag-icon">üö©</div>
            <div class="flag-pole"></div>
          </div>

          <div class="movers" id="movers">
            <div class="rope"></div>

            <!-- BLUE TEAM -->
            <div class="team-group left">
              <div class="player-fig"><svg viewBox="0 0 58 128" xmlns="http://www.w3.org/2000/svg" fill="none"><ellipse cx="29" cy="124" rx="15" ry="4" fill="rgba(0,0,0,0.28)"/><rect x="9" y="109" width="15" height="11" rx="3" fill="#1a1206"/><rect x="9" y="116" width="19" height="4" rx="2" fill="#110e04"/><rect x="29" y="109" width="15" height="11" rx="3" fill="#1a1206"/><rect x="29" y="116" width="19" height="4" rx="2" fill="#110e04"/><line x1="12" y1="111" x2="22" y2="111" stroke="rgba(255,255,255,0.4)" stroke-width="1"/><line x1="32" y1="111" x2="42" y2="111" stroke="rgba(255,255,255,0.4)" stroke-width="1"/><rect x="11" y="80" width="13" height="33" rx="5" fill="#1a3a6b"/><rect x="31" y="80" width="13" height="33" rx="5" fill="#152e55"/><rect x="9" y="79" width="38" height="5" rx="2" fill="#0d1f3a"/><rect x="25" y="80" width="8" height="4" rx="1" fill="#c8a900"/><rect x="9" y="47" width="38" height="36" rx="7" fill="#1A4FC4"/><path d="M20 47 Q29 54 38 47" fill="#1660e0" opacity="0.4"/><rect x="9" y="56" width="38" height="4" rx="1" fill="#5B9BD5" opacity="0.7"/><rect x="9" y="68" width="38" height="3" rx="1" fill="#0B2D8C" opacity="0.8"/><path d="M9 55 Q-1 59 -7 64" stroke="#1A4FC4" stroke-width="8" stroke-linecap="round"/><path d="M9 55 Q-1 59 -7 64" stroke="#FFCC99" stroke-width="5.5" stroke-linecap="round"/><ellipse cx="-7" cy="65" rx="6" ry="5" fill="#FFCC99"/><path d="M47 53 Q55 57 53 68" stroke="#1A4FC4" stroke-width="8" stroke-linecap="round"/><path d="M47 53 Q55 57 53 68" stroke="#FFCC99" stroke-width="5.5" stroke-linecap="round"/><ellipse cx="53" cy="69" rx="5" ry="4.5" fill="#FFCC99"/><rect x="23" y="38" width="12" height="12" rx="4" fill="#FFCC99"/><ellipse cx="29" cy="27" rx="16" ry="17" fill="#FFCC99"/><path d="M15 30 Q17 38 29 40 Q41 38 43 30" fill="#F5B07A" opacity="0.4"/><ellipse cx="29" cy="12" rx="16" ry="8" fill="#3D2007"/><rect x="13" y="12" width="32" height="9" rx="3" fill="#3D2007"/><rect x="13" y="19" width="32" height="7" rx="3.5" fill="#0B2D8C"/><rect x="13" y="19" width="32" height="3" rx="2" fill="#1A4FC4"/><ellipse cx="13" cy="29" rx="4" ry="5.5" fill="#F5B07A"/><ellipse cx="45" cy="29" rx="4" ry="5.5" fill="#F5B07A"/><ellipse cx="21" cy="28" rx="4.5" ry="5" fill="white"/><ellipse cx="37" cy="28" rx="4.5" ry="5" fill="white"/><circle cx="22" cy="29" r="3" fill="#2c6b8a"/><circle cx="38" cy="29" r="3" fill="#2c6b8a"/><circle cx="22" cy="29.5" r="1.8" fill="#0d1a0d"/><circle cx="38" cy="29.5" r="1.8" fill="#0d1a0d"/><circle cx="23.2" cy="28" r="0.9" fill="white"/><circle cx="39.2" cy="28" r="0.9" fill="white"/><path d="M17 22 Q21 19 25 22" stroke="#3D2007" stroke-width="2.2" stroke-linecap="round" fill="none"/><path d="M33 22 Q37 19 41 22" stroke="#3D2007" stroke-width="2.2" stroke-linecap="round" fill="none"/><path d="M27 31 Q29 35 31 31" stroke="#C88C5A" stroke-width="1.5" fill="none" stroke-linecap="round"/><path d="M20 37 Q29 41.5 38 37" stroke="#8B2222" stroke-width="1.5" fill="rgba(80,10,10,0.6)" stroke-linecap="round"/><rect x="22" y="37" width="14" height="3.5" rx="1" fill="white"/><ellipse cx="7" cy="20" rx="2" ry="3" fill="rgba(91,155,213,0.65)"/></svg></div>
              <div class="player-fig"><svg viewBox="0 0 58 128" xmlns="http://www.w3.org/2000/svg" fill="none"><ellipse cx="29" cy="124" rx="15" ry="4" fill="rgba(0,0,0,0.28)"/><rect x="9" y="109" width="15" height="11" rx="3" fill="#1a1206"/><rect x="9" y="116" width="19" height="4" rx="2" fill="#110e04"/><rect x="29" y="109" width="15" height="11" rx="3" fill="#1a1206"/><rect x="29" y="116" width="19" height="4" rx="2" fill="#110e04"/><rect x="11" y="80" width="13" height="33" rx="5" fill="#1a3a6b"/><rect x="31" y="80" width="13" height="33" rx="5" fill="#152e55"/><rect x="9" y="79" width="38" height="5" rx="2" fill="#0d1f3a"/><rect x="25" y="80" width="8" height="4" rx="1" fill="#c8a900"/><rect x="9" y="47" width="38" height="36" rx="7" fill="#1A4FC4"/><path d="M9 53 Q-2 57 -6 63" stroke="#1A4FC4" stroke-width="8" stroke-linecap="round"/><path d="M9 53 Q-2 57 -6 63" stroke="#C8865A" stroke-width="5.5" stroke-linecap="round"/><ellipse cx="-6" cy="64" rx="6" ry="5" fill="#C8865A"/><path d="M47 53 Q55 59 52 70" stroke="#1A4FC4" stroke-width="8" stroke-linecap="round"/><path d="M47 53 Q55 59 52 70" stroke="#C8865A" stroke-width="5.5" stroke-linecap="round"/><ellipse cx="52" cy="71" rx="5" ry="4.5" fill="#C8865A"/><rect x="23" y="38" width="12" height="12" rx="4" fill="#C8865A"/><ellipse cx="29" cy="27" rx="16" ry="17" fill="#C8865A"/><ellipse cx="29" cy="12" rx="16" ry="8" fill="#0d0604"/><rect x="13" y="12" width="32" height="9" rx="3" fill="#0d0604"/><rect x="13" y="19" width="32" height="7" rx="3.5" fill="#0B2D8C"/><rect x="13" y="19" width="32" height="3" rx="2" fill="#1A4FC4"/><ellipse cx="13" cy="29" rx="4" ry="5.5" fill="#b06c3a"/><ellipse cx="45" cy="29" rx="4" ry="5.5" fill="#b06c3a"/><ellipse cx="21" cy="28" rx="4.5" ry="5" fill="white"/><ellipse cx="37" cy="28" rx="4.5" ry="5" fill="white"/><circle cx="22" cy="29" r="3" fill="#3d2200"/><circle cx="38" cy="29" r="3" fill="#3d2200"/><circle cx="22" cy="29.5" r="1.8" fill="#0d0500"/><circle cx="38" cy="29.5" r="1.8" fill="#0d0500"/><circle cx="23.2" cy="28" r="0.9" fill="white"/><circle cx="39.2" cy="28" r="0.9" fill="white"/><path d="M17 22 Q21 19 25 22" stroke="#0d0604" stroke-width="2.5" stroke-linecap="round" fill="none"/><path d="M33 22 Q37 19 41 22" stroke="#0d0604" stroke-width="2.5" stroke-linecap="round" fill="none"/><path d="M20 37 Q29 41.5 38 37" stroke="#6b1515" stroke-width="1.5" fill="rgba(60,10,10,0.6)" stroke-linecap="round"/><rect x="22" y="37" width="14" height="3.5" rx="1" fill="rgba(240,230,220,0.95)"/></svg></div>
              <div class="player-fig"><svg viewBox="0 0 58 128" xmlns="http://www.w3.org/2000/svg" fill="none"><ellipse cx="29" cy="124" rx="15" ry="4" fill="rgba(0,0,0,0.28)"/><rect x="9" y="109" width="15" height="11" rx="3" fill="#1a1206"/><rect x="9" y="116" width="19" height="4" rx="2" fill="#110e04"/><rect x="29" y="109" width="15" height="11" rx="3" fill="#1a1206"/><rect x="29" y="116" width="19" height="4" rx="2" fill="#110e04"/><rect x="11" y="80" width="13" height="33" rx="5" fill="#1a3a6b"/><rect x="31" y="80" width="13" height="33" rx="5" fill="#152e55"/><rect x="9" y="79" width="38" height="5" rx="2" fill="#0d1f3a"/><rect x="25" y="80" width="8" height="4" rx="1" fill="#c8a900"/><rect x="9" y="47" width="38" height="36" rx="7" fill="#1A4FC4"/><rect x="9" y="53" width="38" height="4" rx="1" fill="#0B2D8C" opacity="0.8"/><path d="M9 57 Q-2 61 -8 66" stroke="#1A4FC4" stroke-width="8" stroke-linecap="round"/><path d="M9 57 Q-2 61 -8 66" stroke="#d4aa80" stroke-width="5.5" stroke-linecap="round"/><ellipse cx="-8" cy="67" rx="6" ry="5" fill="#d4aa80"/><path d="M47 55 Q55 60 52 71" stroke="#1A4FC4" stroke-width="8" stroke-linecap="round"/><path d="M47 55 Q55 60 52 71" stroke="#d4aa80" stroke-width="5.5" stroke-linecap="round"/><ellipse cx="52" cy="72" rx="5" ry="4.5" fill="#d4aa80"/><rect x="23" y="38" width="12" height="12" rx="4" fill="#d4aa80"/><ellipse cx="29" cy="27" rx="16" ry="17" fill="#d4aa80"/><ellipse cx="29" cy="12" rx="16" ry="8" fill="#1a0c00"/><rect x="13" y="12" width="32" height="9" rx="3" fill="#1a0c00"/><path d="M13 18 Q10 26 12 32" fill="#1a0c00"/><path d="M45 18 Q48 26 46 32" fill="#1a0c00"/><rect x="13" y="19" width="32" height="7" rx="3.5" fill="#0B2D8C"/><rect x="13" y="19" width="32" height="3" rx="2" fill="#1A4FC4"/><ellipse cx="13" cy="29" rx="4" ry="5.5" fill="#c09060"/><ellipse cx="45" cy="29" rx="4" ry="5.5" fill="#c09060"/><ellipse cx="21" cy="28" rx="4.5" ry="5" fill="white"/><ellipse cx="37" cy="28" rx="4.5" ry="5" fill="white"/><circle cx="22" cy="29" r="3" fill="#1a1200"/><circle cx="38" cy="29" r="3" fill="#1a1200"/><circle cx="22" cy="29.5" r="1.8" fill="#050400"/><circle cx="38" cy="29.5" r="1.8" fill="#050400"/><circle cx="23.2" cy="28" r="0.9" fill="white"/><circle cx="39.2" cy="28" r="0.9" fill="white"/><path d="M17 22 Q21 19.5 25 22" stroke="#1a0c00" stroke-width="2" stroke-linecap="round" fill="none"/><path d="M33 22 Q37 19.5 41 22" stroke="#1a0c00" stroke-width="2" stroke-linecap="round" fill="none"/><path d="M20 37 Q29 42 38 37" stroke="#7a1515" stroke-width="1.5" fill="rgba(50,8,8,0.6)" stroke-linecap="round"/><rect x="22" y="37" width="14" height="3.5" rx="1" fill="rgba(245,235,220,0.95)"/></svg></div>
            </div>

            <!-- RED TEAM -->
            <div class="team-group right">
              <div class="player-fig"><svg viewBox="0 0 58 128" xmlns="http://www.w3.org/2000/svg" fill="none"><ellipse cx="29" cy="124" rx="15" ry="4" fill="rgba(0,0,0,0.28)"/><rect x="9" y="109" width="15" height="11" rx="3" fill="#1a1206"/><rect x="9" y="116" width="19" height="4" rx="2" fill="#110e04"/><rect x="29" y="109" width="15" height="11" rx="3" fill="#1a1206"/><rect x="29" y="116" width="19" height="4" rx="2" fill="#110e04"/><rect x="11" y="80" width="13" height="33" rx="5" fill="#6b1a1a"/><rect x="31" y="80" width="13" height="33" rx="5" fill="#501010"/><rect x="9" y="79" width="38" height="5" rx="2" fill="#280808"/><rect x="25" y="80" width="8" height="4" rx="1" fill="#c8a900"/><rect x="9" y="47" width="38" height="36" rx="7" fill="#C41A1A"/><path d="M20 47 Q29 54 38 47" fill="#e03030" opacity="0.35"/><rect x="9" y="56" width="38" height="4" rx="1" fill="#E05252" opacity="0.7"/><rect x="9" y="68" width="38" height="3" rx="1" fill="#8C0B0B" opacity="0.8"/><path d="M49 55 Q59 59 65 64" stroke="#C41A1A" stroke-width="8" stroke-linecap="round"/><path d="M49 55 Q59 59 65 64" stroke="#FFCC99" stroke-width="5.5" stroke-linecap="round"/><ellipse cx="65" cy="65" rx="6" ry="5" fill="#FFCC99"/><path d="M9 53 Q1 57 3 68" stroke="#C41A1A" stroke-width="8" stroke-linecap="round"/><path d="M9 53 Q1 57 3 68" stroke="#FFCC99" stroke-width="5.5" stroke-linecap="round"/><ellipse cx="3" cy="69" rx="5" ry="4.5" fill="#FFCC99"/><rect x="23" y="38" width="12" height="12" rx="4" fill="#FFCC99"/><ellipse cx="29" cy="27" rx="16" ry="17" fill="#FFCC99"/><ellipse cx="29" cy="12" rx="16" ry="8" fill="#3D2007"/><rect x="13" y="12" width="32" height="9" rx="3" fill="#3D2007"/><rect x="13" y="19" width="32" height="7" rx="3.5" fill="#8C0B0B"/><rect x="13" y="19" width="32" height="3" rx="2" fill="#C41A1A"/><ellipse cx="13" cy="29" rx="4" ry="5.5" fill="#F5B07A"/><ellipse cx="45" cy="29" rx="4" ry="5.5" fill="#F5B07A"/><ellipse cx="21" cy="28" rx="4.5" ry="5" fill="white"/><ellipse cx="37" cy="28" rx="4.5" ry="5" fill="white"/><circle cx="22" cy="29" r="3" fill="#2c6b3a"/><circle cx="38" cy="29" r="3" fill="#2c6b3a"/><circle cx="22" cy="29.5" r="1.8" fill="#0a1a0a"/><circle cx="38" cy="29.5" r="1.8" fill="#0a1a0a"/><circle cx="23.2" cy="28" r="0.9" fill="white"/><circle cx="39.2" cy="28" r="0.9" fill="white"/><path d="M17 22 Q21 19 25 22" stroke="#3D2007" stroke-width="2.2" stroke-linecap="round" fill="none"/><path d="M33 22 Q37 19 41 22" stroke="#3D2007" stroke-width="2.2" stroke-linecap="round" fill="none"/><path d="M20 37 Q29 41.5 38 37" stroke="#6b1515" stroke-width="1.5" fill="rgba(80,10,10,0.6)" stroke-linecap="round"/><rect x="22" y="37" width="14" height="3.5" rx="1" fill="white"/><ellipse cx="50" cy="20" rx="2" ry="3" fill="rgba(224,82,82,0.65)"/></svg></div>
              <div class="player-fig"><svg viewBox="0 0 58 128" xmlns="http://www.w3.org/2000/svg" fill="none"><ellipse cx="29" cy="124" rx="15" ry="4" fill="rgba(0,0,0,0.28)"/><rect x="9" y="109" width="15" height="11" rx="3" fill="#1a1206"/><rect x="9" y="116" width="19" height="4" rx="2" fill="#110e04"/><rect x="29" y="109" width="15" height="11" rx="3" fill="#1a1206"/><rect x="29" y="116" width="19" height="4" rx="2" fill="#110e04"/><rect x="11" y="80" width="13" height="33" rx="5" fill="#6b1a1a"/><rect x="31" y="80" width="13" height="33" rx="5" fill="#501010"/><rect x="9" y="79" width="38" height="5" rx="2" fill="#280808"/><rect x="25" y="80" width="8" height="4" rx="1" fill="#c8a900"/><rect x="9" y="47" width="38" height="36" rx="7" fill="#C41A1A"/><path d="M49 53 Q59 57 64 63" stroke="#C41A1A" stroke-width="8" stroke-linecap="round"/><path d="M49 53 Q59 57 64 63" stroke="#C8865A" stroke-width="5.5" stroke-linecap="round"/><ellipse cx="64" cy="64" rx="6" ry="5" fill="#C8865A"/><path d="M9 55 Q1 59 3 70" stroke="#C41A1A" stroke-width="8" stroke-linecap="round"/><path d="M9 55 Q1 59 3 70" stroke="#C8865A" stroke-width="5.5" stroke-linecap="round"/><ellipse cx="3" cy="71" rx="5" ry="4.5" fill="#C8865A"/><rect x="23" y="38" width="12" height="12" rx="4" fill="#C8865A"/><ellipse cx="29" cy="27" rx="16" ry="17" fill="#C8865A"/><ellipse cx="29" cy="12" rx="16" ry="8" fill="#0d0604"/><rect x="13" y="12" width="32" height="9" rx="3" fill="#0d0604"/><rect x="13" y="19" width="32" height="7" rx="3.5" fill="#8C0B0B"/><rect x="13" y="19" width="32" height="3" rx="2" fill="#C41A1A"/><ellipse cx="13" cy="29" rx="4" ry="5.5" fill="#b06c3a"/><ellipse cx="45" cy="29" rx="4" ry="5.5" fill="#b06c3a"/><ellipse cx="21" cy="28" rx="4.5" ry="5" fill="white"/><ellipse cx="37" cy="28" rx="4.5" ry="5" fill="white"/><circle cx="22" cy="29" r="3" fill="#3d1c00"/><circle cx="38" cy="29" r="3" fill="#3d1c00"/><circle cx="22" cy="29.5" r="1.8" fill="#100600"/><circle cx="38" cy="29.5" r="1.8" fill="#100600"/><circle cx="23.2" cy="28" r="0.9" fill="white"/><circle cx="39.2" cy="28" r="0.9" fill="white"/><path d="M17 22 Q21 19 25 22" stroke="#0d0604" stroke-width="2.5" stroke-linecap="round" fill="none"/><path d="M33 22 Q37 19 41 22" stroke="#0d0604" stroke-width="2.5" stroke-linecap="round" fill="none"/><path d="M20 37 Q29 41.5 38 37" stroke="#6b1515" stroke-width="1.5" fill="rgba(60,10,10,0.6)" stroke-linecap="round"/><rect x="22" y="37" width="14" height="3.5" rx="1" fill="rgba(240,230,220,0.95)"/></svg></div>
              <div class="player-fig"><svg viewBox="0 0 58 128" xmlns="http://www.w3.org/2000/svg" fill="none"><ellipse cx="29" cy="124" rx="15" ry="4" fill="rgba(0,0,0,0.28)"/><rect x="9" y="109" width="15" height="11" rx="3" fill="#1a1206"/><rect x="9" y="116" width="19" height="4" rx="2" fill="#110e04"/><rect x="29" y="109" width="15" height="11" rx="3" fill="#1a1206"/><rect x="29" y="116" width="19" height="4" rx="2" fill="#110e04"/><rect x="11" y="80" width="13" height="33" rx="5" fill="#6b1a1a"/><rect x="31" y="80" width="13" height="33" rx="5" fill="#501010"/><rect x="9" y="79" width="38" height="5" rx="2" fill="#280808"/><rect x="25" y="80" width="8" height="4" rx="1" fill="#c8a900"/><rect x="9" y="47" width="38" height="36" rx="7" fill="#C41A1A"/><rect x="9" y="53" width="38" height="4" rx="1" fill="#8C0B0B" opacity="0.8"/><path d="M49 57 Q60 61 65 66" stroke="#C41A1A" stroke-width="8" stroke-linecap="round"/><path d="M49 57 Q60 61 65 66" stroke="#d4aa80" stroke-width="5.5" stroke-linecap="round"/><ellipse cx="65" cy="67" rx="6" ry="5" fill="#d4aa80"/><path d="M9 55 Q1 58 3 70" stroke="#C41A1A" stroke-width="8" stroke-linecap="round"/><path d="M9 55 Q1 58 3 70" stroke="#d4aa80" stroke-width="5.5" stroke-linecap="round"/><ellipse cx="3" cy="71" rx="5" ry="4.5" fill="#d4aa80"/><rect x="23" y="38" width="12" height="12" rx="4" fill="#d4aa80"/><ellipse cx="29" cy="27" rx="16" ry="17" fill="#d4aa80"/><ellipse cx="29" cy="12" rx="16" ry="8" fill="#1a0c00"/><rect x="13" y="12" width="32" height="9" rx="3" fill="#1a0c00"/><path d="M13 18 Q10 26 12 32" fill="#1a0c00"/><path d="M45 18 Q48 26 46 32" fill="#1a0c00"/><rect x="13" y="19" width="32" height="7" rx="3.5" fill="#8C0B0B"/><rect x="13" y="19" width="32" height="3" rx="2" fill="#C41A1A"/><ellipse cx="13" cy="29" rx="4" ry="5.5" fill="#c09060"/><ellipse cx="45" cy="29" rx="4" ry="5.5" fill="#c09060"/><ellipse cx="21" cy="28" rx="4.5" ry="5" fill="white"/><ellipse cx="37" cy="28" rx="4.5" ry="5" fill="white"/><circle cx="22" cy="29" r="3" fill="#1a0800"/><circle cx="38" cy="29" r="3" fill="#1a0800"/><circle cx="22" cy="29.5" r="1.8" fill="#050200"/><circle cx="38" cy="29.5" r="1.8" fill="#050200"/><circle cx="23.2" cy="28" r="0.9" fill="white"/><circle cx="39.2" cy="28" r="0.9" fill="white"/><path d="M17 22 Q21 19.5 25 22" stroke="#1a0c00" stroke-width="2" stroke-linecap="round" fill="none"/><path d="M33 22 Q37 19.5 41 22" stroke="#1a0c00" stroke-width="2" stroke-linecap="round" fill="none"/><path d="M20 37 Q29 42 38 37" stroke="#6b1515" stroke-width="1.5" fill="rgba(50,8,8,0.6)" stroke-linecap="round"/><rect x="22" y="37" width="14" height="3.5" rx="1" fill="rgba(245,235,220,0.95)"/></svg></div>
            </div>
          </div><!-- movers -->
        </div><!-- rope-stage -->
      </div><!-- arena -->

      <!-- TEAM 2 PANEL -->
      <div class="team-panel red" id="t2Panel">
        <div class="panel-inner">
          <div class="panel-header">
            <div class="team-name" style="color:var(--red-l)">Team 2</div>
            <div class="q-badge" id="t2Badge">1/10</div>
          </div>
          <div class="question-box">
            <div class="question-text" id="t2Q">?+?=?</div>
            <div class="answer-display empty" id="t2Display">?</div>
          </div>
        </div>
        <div class="keypad" id="t2Pad"></div>
      </div>

    </div><!-- game-main -->
  </div><!-- game-screen -->

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WINNER SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="screen" id="winner-screen">
    <div class="winner-crown">üëë</div>
    <div class="winner-title">WINNER!</div>
    <div class="winner-team-name" id="winnerBadge">Team 1</div>
    <div class="final-score-row">
      <div class="final-box blue"><div class="final-num" id="finalT1">0</div><div class="final-lbl">Team 1</div></div>
      <div class="vs-sep">VS</div>
      <div class="final-box red"><div class="final-num" id="finalT2">0</div><div class="final-lbl">Team 2</div></div>
    </div>
    <button class="play-again-btn" id="playAgainBtn">üîÑ Play Again</button>
  </div>

  <div class="flash-overlay t1" id="flashT1"></div>
  <div class="flash-overlay t2" id="flashT2"></div>
  <div id="confetti"></div>

  <script>
  /* ============================================================
     TUG OF WAR ‚Äî GAME LOGIC
  ============================================================ */

  // ‚îÄ‚îÄ Audio ‚îÄ‚îÄ
  let _ac=null;
  function ac(){if(!_ac)_ac=new(window.AudioContext||window.webkitAudioContext)();return _ac;}
  function tone(f,d,t='sine',v=0.28){
    try{const c=ac(),o=c.createOscillator(),g=c.createGain();
    o.connect(g);g.connect(c.destination);o.type=t;o.frequency.value=f;
    g.gain.setValueAtTime(v,c.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001,c.currentTime+d);
    o.start();o.stop(c.currentTime+d);}catch(e){}
  }
  function sfxOk(){ tone(523,.08); setTimeout(()=>tone(659,.08),85); setTimeout(()=>tone(784,.18),170); }
  function sfxNo(){ tone(165,.3,'sawtooth',.2); }
  function sfxWin(){ [523,659,784,1047,1319].forEach((n,i)=>setTimeout(()=>tone(n,.22,'square',.16),i*120)); }

  // ‚îÄ‚îÄ Config ‚îÄ‚îÄ
  const DIFFS={ easy:{m:9}, medium:{m:18}, hard:{m:35} };
  let diff='easy';
  const TOTAL=10, QTIME=10, STEP=7;

  // ‚îÄ‚îÄ State ‚îÄ‚îÄ
  let G={};
  function resetG(){
    G={t1:{qs:[],i:0,s:0,done:false,val:''},
       t2:{qs:[],i:0,s:0,done:false,val:''},
       rope:50,timer:QTIME,iv:null,over:false};
  }
  function genQ(){ const m=DIFFS[diff].m,a=Math.ceil(Math.random()*m),b=Math.ceil(Math.random()*m); return{txt:`${a}+${b}=?`,ans:a+b}; }
  function genQs(){ return Array.from({length:TOTAL},genQ); }

  // ‚îÄ‚îÄ Screens ‚îÄ‚îÄ
  function show(id){ document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); }

  // ‚îÄ‚îÄ Responsive: wrap panel contents for portrait layout ‚îÄ‚îÄ
  function applyPortraitWrap() {
    const isPortrait = window.innerHeight > window.innerWidth || window.innerWidth < 768;
    [1,2].forEach(tn => {
      const panel = document.getElementById(`t${tn}Panel`);
      const inner = panel.querySelector('.panel-inner');
      // Already wrapped in HTML ‚Äî just ensure keypad is sibling of panel-inner
      // Nothing dynamic needed; CSS handles the layout switch
    });
  }

  // ‚îÄ‚îÄ Build Keypad (pointerdown ‚Äî no double fire) ‚îÄ‚îÄ
  function buildPad(padId, tn) {
    const p = document.getElementById(padId);
    p.innerHTML = '';
    function mk(label, cls, action) {
      const b = document.createElement('button');
      b.className = 'key ' + cls;
      b.textContent = label;
      b.type = 'button';
      b.addEventListener('pointerdown', e => { e.preventDefault(); kp(tn, action); });
      p.appendChild(b);
    }
    [1,2,3,4,5,6,7,8,9].forEach(n => mk(String(n),'digit',String(n)));
    mk('‚úï','clear','clear');
    mk('0','digit','0');
    mk('‚úì OK','submit','submit');
  }

  function updateDisplay(tn) {
    const t = tn===1?G.t1:G.t2;
    const el = document.getElementById(`t${tn}Display`);
    if (t.val === '') {
      el.textContent = '?';
      el.className = 'answer-display empty';
    } else {
      el.textContent = t.val;
      el.className = 'answer-display has-val';
    }
  }

  function kp(tn, k) {
    if(G.over) return;
    const t = tn===1?G.t1:G.t2;
    if(t.done) return;
    if(k==='clear') { t.val=''; updateDisplay(tn); }
    else if(k==='submit') submit(tn);
    else if(t.val.length < 4) { t.val += k; updateDisplay(tn); }
  }

  function submit(tn) {
    if(G.over) return;
    const t = tn===1?G.t1:G.t2;
    if(t.done) return;
    const v = parseInt(t.val, 10);
    if(isNaN(v)) return;

    const display = document.getElementById(`t${tn}Display`);
    if(v === t.qs[t.i].ans) {
      sfxOk(); t.s++; t.i++;
      flash(tn); moveRope(tn); refreshUI();
      t.val = ''; updateDisplay(tn);
      display.classList.add('flash-ok');
      setTimeout(()=>display.classList.remove('flash-ok'), 480);

      if(G.rope<=10){end(1);return;}
      if(G.rope>=90){end(2);return;}

      if(t.i>=TOTAL) {
        t.done=true;
        document.getElementById(`t${tn}Panel`).classList.add('done');
        if(G.t1.done&&G.t2.done){end(0);return;}
      } else loadQ(tn);
      resetTimer();
    } else {
      sfxNo();
      t.val=''; updateDisplay(tn);
      display.classList.add('shake');
      display.style.borderColor='#E05252';
      setTimeout(()=>{ display.classList.remove('shake'); display.style.borderColor=''; }, 450);
    }
  }

  function moveRope(tn) {
    G.rope = tn===1 ? Math.max(0,G.rope-STEP) : Math.min(100,G.rope+STEP);
    const stage = document.getElementById('ropeStage');
    const offset = ((G.rope-50)/100) * stage.offsetWidth * 0.72;
    document.getElementById('movers').style.transform = `translateX(${offset}px)`;
  }

  function flash(tn) {
    const el = document.getElementById(`flashT${tn}`);
    el.classList.remove('show'); void el.offsetWidth; el.classList.add('show');
    setTimeout(()=>el.classList.remove('show'), 650);
  }

  function refreshUI() {
    document.getElementById('t1Score').textContent = G.t1.s;
    document.getElementById('t2Score').textContent = G.t2.s;
    document.getElementById('aT1').textContent = G.t1.s;
    document.getElementById('aT2').textContent = G.t2.s;
    document.getElementById('t1Prog').style.width = (G.t1.s/TOTAL*100)+'%';
    document.getElementById('t2Prog').style.width = (G.t2.s/TOTAL*100)+'%';
  }

  function loadQ(tn) {
    const t = tn===1?G.t1:G.t2;
    document.getElementById(`t${tn}Q`).textContent = t.qs[t.i].txt;
    document.getElementById(`t${tn}Badge`).textContent = `${t.i+1}/10`;
    t.val=''; updateDisplay(tn);
  }

  function startTimer() {
    G.timer = QTIME;
    const el = document.getElementById('timerEl');
    el.classList.remove('urgent'); el.textContent = QTIME;
    clearInterval(G.iv);
    G.iv = setInterval(()=>{
      G.timer--;
      el.textContent = G.timer;
      if(G.timer<=3) el.classList.add('urgent');
      if(G.timer<=0) {
        [1,2].forEach(tn => {
          const t = tn===1?G.t1:G.t2; if(t.done) return;
          t.i++;
          if(t.i>=TOTAL){t.done=true;document.getElementById(`t${tn}Panel`).classList.add('done');}
          else loadQ(tn);
        });
        if(G.t1.done&&G.t2.done){end(0);return;}
        resetTimer();
      }
    }, 1000);
  }
  function resetTimer(){ clearInterval(G.iv); startTimer(); }

  function end(w) {
    G.over=true; clearInterval(G.iv);
    if(w===0){if(G.t1.s>G.t2.s)w=1;else if(G.t2.s>G.t1.s)w=2;}
    setTimeout(()=>{
      show('winner-screen');
      const b = document.getElementById('winnerBadge');
      if(w===1){b.textContent='üèÖ Team 1 Wins!';b.className='winner-team-name blue';}
      else if(w===2){b.textContent='üèÖ Team 2 Wins!';b.className='winner-team-name red';}
      else{b.textContent="ü§ù It's a Draw!";b.className='winner-team-name draw';}
      document.getElementById('finalT1').textContent = G.t1.s;
      document.getElementById('finalT2').textContent = G.t2.s;
      sfxWin(); spawnConfetti();
    }, 550);
  }

  function spawnConfetti() {
    const c = document.getElementById('confetti'); c.innerHTML='';
    const cols=['#FFD600','#1A4FC4','#C41A1A','#2E7D32','#FF6F00','#fff','#E91E63','#00BCD4'];
    for(let i=0;i<140;i++){
      const p = document.createElement('div'); p.className='conf';
      p.style.cssText=`left:${Math.random()*100}vw;width:${Math.random()*9+4}px;height:${Math.random()*9+4}px;background:${cols[Math.floor(Math.random()*cols.length)]};border-radius:${Math.random()>.5?'50%':'3px'};animation-duration:${Math.random()*2.5+2}s;animation-delay:${Math.random()*2}s;`;
      c.appendChild(p);
    }
    setTimeout(()=>c.innerHTML='', 7000);
  }

  function initGame() {
    resetG();
    G.t1.qs=genQs(); G.t2.qs=genQs();
    [1,2].forEach(tn=>{
      document.getElementById(`t${tn}Panel`).classList.remove('done');
    });
    document.getElementById('movers').style.transform = 'translateX(0)';
    document.getElementById('timerEl').classList.remove('urgent');
    buildPad('t1Pad',1); buildPad('t2Pad',2);
    loadQ(1); loadQ(2); refreshUI();
    startTimer();
    show('game-screen');
  }

  // ‚îÄ‚îÄ Event Wiring ‚îÄ‚îÄ
  document.querySelectorAll('.diff-btn').forEach(b=>{
    b.addEventListener('click',()=>{
      document.querySelectorAll('.diff-btn').forEach(x=>x.classList.remove('active'));
      b.classList.add('active'); diff=b.dataset.diff;
    });
  });
  document.getElementById('startBtn').addEventListener('click',()=>{ try{ac();}catch(e){} initGame(); });
  document.getElementById('playAgainBtn').addEventListener('click',()=>{ document.getElementById('confetti').innerHTML=''; show('start-screen'); });

  // Physical keyboard (Team 1 = left panel)
  document.addEventListener('keydown',e=>{
    if(!document.getElementById('game-screen').classList.contains('active')) return;
    if('0123456789'.includes(e.key)&&!e.ctrlKey&&!e.metaKey){ kp(1,e.key); e.preventDefault(); }
    if(e.key==='Enter'){ kp(1,'submit'); e.preventDefault(); }
    if(e.key==='Backspace'){ kp(1,'clear'); e.preventDefault(); }
  });

  // Recalculate rope position on resize/orientation change
  window.addEventListener('resize', ()=>{
    if(!G.over && document.getElementById('game-screen').classList.contains('active')) {
      moveRope(0); // Re-render current rope offset with new stage width
    }
  });

  // Fake moveRope(0) = just recompute transform from current G.rope
  function moveRope(tn) {
    if(tn!==0){
      G.rope = tn===1 ? Math.max(0,G.rope-STEP) : Math.min(100,G.rope+STEP);
    }
    const stage = document.getElementById('ropeStage');
    const offset = ((G.rope-50)/100) * stage.offsetWidth * 0.72;
    document.getElementById('movers').style.transform = `translateX(${offset}px)`;
  }
  </script>
  </body>
  </html>